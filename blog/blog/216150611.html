<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>jcifs的NTLM HTTP验证及所犯错误</title></head><body><h1>jcifs的NTLM HTTP验证及所犯错误</h1><div><p><strong><font size="3">一、错误提示：0xC0000022: jcifs.smb.SmbAuthException: Access is denied</font></strong></p>
<p><font size="3">The NTLM HTTP SSO Filter that used to be included with JCIFS cannot support NTLMv2.</font></p>
<p><font size="3">&nbsp;&nbsp;   1) jcifs.smb.lmCompatibility = 0 or 1: Send LM and NTLM<br>
&nbsp;&nbsp;&nbsp;  2) jcifs.smb.lmCompatibility = 2: Send NTLM in both fields<br>
&nbsp;&nbsp;&nbsp;  3) jcifs.smb.lmCompatibility = 3, 4, or 5: Send just LMv2<br>
</font></p>
<p><font size="3">1、使用包：jcifs-1.3.14.jar</font></p>
<p><font size="3">2、Eclipse的web工程中的web.xml配置：下面黑体配置，解决了错误。</font></p>
<p><font size="3">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>
&lt;web-app xmlns:xsi=&quot;<a href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>&quot; xmlns=&quot;<a href="http://java.sun.com/xml/ns/javaee">http://java.sun.com/xml/ns/javaee</a>&quot; xmlns:web=&quot;<a href="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</a>&quot; xsi:schemaLocation=&quot;<a href="http://java.sun.com/xml/ns/javaee">http://java.sun.com/xml/ns/javaee</a> <a href="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</a>&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;<br>
&lt;display-name&gt;ITSystemSSO&lt;/display-name&gt;<br>
<br>
&nbsp;&nbsp;  &lt;filter&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;WebServicesFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-class&gt;com.channelsoft.sso.ipfilter.IpFilter&lt;/filter-class&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/filter&gt;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  &lt;filter-mapping&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;WebServicesFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/filter-mapping&gt;<br>
&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;  &lt;filter&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;NtlmHttpFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;filter-class&gt;jcifs.http.NtlmHttpFilter&lt;/filter-class&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;init-param&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-name&gt;jcifs.http.domainController&lt;/param-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-value&gt;10.130.1.9&lt;/param-value&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/init-param&gt;</font><font size="3"><br>
&nbsp;&nbsp;&nbsp;  <strong>&lt;init-param&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-name&gt;jcifs.smb.lmCompatibility&lt;/param-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-value&gt;0&lt;/param-value&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/init-param&gt; <br>
&lt;init-param&gt;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  &lt;param-name&gt;jcifs.smb.client.useExtenededSecurity&lt;/param-name&gt;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;  &lt;param-value&gt;false&lt;/param-value&gt; <br>
&lt;/init-param</strong>&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;init-param&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-name&gt;jcifs.smb.client.soTimeout&lt;/param-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;param-value&gt;35000&lt;/param-value&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/init-param&gt;<br>
&lt;/filter&gt;<br>
&lt;filter-mapping&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;NtlmHttpFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br>
&lt;/filter-mapping&gt;<br>
&nbsp;&nbsp;  &lt;filter&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;DenyFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-class&gt;com.channelsoft.sso.deny.DenyAll&lt;/filter-class&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/filter&gt;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;  &lt;filter-mapping&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;filter-name&gt;DenyFilter&lt;/filter-name&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/filter-mapping&gt;<br>
<br>
&lt;welcome-file-list&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;<br>
&lt;/welcome-file-list&gt;<br>
&lt;/web-app&gt;</font></p>
<p><font size="3">3、说明</font></p>
<p><font size="3"><a href="http://lists.samba.org/archive/jcifs/2004-February/003069.html">http://lists.samba.org/archive/jcifs/2004-February/003069.html</a></font></p>
<p><font size="3"><a href="http://www.ioplex.com/d/jespa/api/jespa/ntlm/NtlmSecurityProvider.html">http://www.ioplex.com/d/jespa/api/jespa/ntlm/NtlmSecurityProvider.html</a></font></p>
<p><font size="3"><strong>二、错误提示：</strong><span><span>jcifs.smb.SmbException: NTLMv2 requires extended security (jcifs.smb.client.useExtendedSecurity must be <font color="#006699"><strong>true</strong></font></span><span> <font color="#006699"><strong>if</strong></font></span><span> jcifs.smb.lmCompatibility &gt;= </span><span class="number"><font color="#c00000">3</font></span><span>)&nbsp;&nbsp;</span></span></font></p>
<p> </p>
<p> </p>
<p><font size="3"><strong>如果已经增加了上面黑体部分，则需重启tomcat服务器。</strong></font></p>
<p><font size="3"><strong>三、调试java web程序，时替换jar包，旧jar包修改名称后继续保存在\WebContent\WEB-INF\lib文件夹下，加载旧包，而没有重新加载新包。</strong></font></p></div></body></html>