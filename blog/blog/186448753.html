<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>AJAX调用jsp(服务器端)的例子</title></head><body><h1>AJAX调用jsp(服务器端)的例子</h1><div><p><strong>客户端jsp：</strong></p>
<p>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=GB2312&quot;<br>
pageEncoding=&quot;GB2312&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.AlertEvent&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.config.AlertManager&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.SystemModelFactory&quot;%&gt;</p>
<p>&lt;%<br>
response.setHeader(&quot;Pragma&quot;, &quot;No-cache&quot;);<br>
response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;);<br>
response.setDateHeader(&quot;Expires&quot;, 0);<br>
%&gt;</p>
<p>&lt;html&gt;</p>
<p>&lt;head&gt;<br>
&lt;meta http-equiv=&quot;Content-Language&quot; content=&quot;zh-cn&quot;&gt;<br>
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=gb2312&quot;&gt;<br>
&lt;LINK href=&quot;images/ivr.css&quot; type=text/css rel=stylesheet&gt;<br>
&lt;meta name=&quot;GENERATOR&quot; content=&quot;Microsoft FrontPage 4.0&quot;&gt;<br>
&lt;meta name=&quot;ProgId&quot; content=&quot;FrontPage.Editor.Document&quot;&gt;</p>
<p><strong>&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot;&gt;</strong></p>
<p><strong><br>
setInterval(&quot;createObject();&quot;,5000);//循环调用createObject();</strong></p>
<p><strong><br>
function createObject()<br>
{<br>
var xmlHttp;<br>
<br>
try<br>
{<br>
&nbsp;&nbsp;  // Firefox, Opera 8.0+, Safari<br>
&nbsp;&nbsp;&nbsp;  xmlHttp=new XMLHttpRequest();<br>
}<br>
catch (e)<br>
{<br>
<br>
&nbsp;&nbsp;  // Internet Explorer<br>
&nbsp;&nbsp;&nbsp;  try<br>
&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  xmlHttp=new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  catch (e)<br>
&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  try<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  xmlHttp=new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  catch (e)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  alert(&quot;您的浏览器不支持AJAX！&quot;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  return false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
}<br>
xmlHttp.onreadystatechange=function()<br>
&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;  if(xmlHttp.readyState==4)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(xmlHttp.status==200)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  var str=xmlHttp.responseText;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  var strIndex=str.indexOf(&quot;[&quot;); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  if(strIndex!=-1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;  document.getElementById(&quot;txtHint&quot;).innerHTML=xmlHttp.responseText; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }else{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;  document.getElementById(&quot;txtHint&quot;).innerHTML=&quot;IVRAdmin后台服务停止！&quot;; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;&nbsp;  }<br>
&nbsp;&nbsp;  xmlHttp.open(&quot;GET&quot;,&quot;AlertManager.jsp&quot;,true);<br>
&nbsp;&nbsp;  xmlHttp.send(null); <br>
}<br>
&lt;/script&gt;</strong></p>
<p><br>
&lt;title&gt;最近告警&lt;/title&gt;<br>
&lt;style type=&quot;text/css&quot;&gt;<br>
&lt;!--<br>
body {<br>
background-color: #E4E4E4;<br>
}<br>
body,td,th {<br>
color: #CC0000;<br>
}<br>
--&gt;<br>
&lt;/style&gt;<br>
&lt;base target=&quot;main&quot;&gt;<br>
&lt;/head&gt;</p>
<p>&lt;body&gt;<br>
&lt;table width=&quot;100%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;<br>
&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;td height=&quot;1&quot; bgcolor=&quot;#D1D1D1&quot;&gt;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;/table&gt;<br>
&lt;table width=&quot;98%&quot; border=&quot;0&quot; align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;<br>
&lt;tr&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;td align=&quot;left&quot; class=&quot;a12&quot;&gt;<br>
&nbsp;&nbsp;  &lt;div id=&quot;txtHint&quot;&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;  &lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;/table&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;</p>
<p><strong>服务器端jsp:</strong></p>
<p>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=GB2312&quot;<br>
pageEncoding=&quot;GB2312&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.AlertEvent&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.config.AlertManager&quot;%&gt;<br>
&lt;%@ page import=&quot;com.channelsoft.ivrmonitor.model.SystemModelFactory&quot;%&gt;</p>
<p><strong>必须有这些代码，负责AJAX调用不正常</strong></p>
<p><strong>//禁止服务器端缓存,否则会在缓存中取数据，不执行服务器端操作<br>
</strong></p>
<p><strong>&lt;%</strong><strong> response.setHeader(&quot;Pragma&quot;, &quot;No-cache&quot;);<br>
response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;);<br>
response.setDateHeader(&quot;Expires&quot;, 0);<br>
%&gt;</strong></p>
<p>&lt;html&gt;</p>
<p>&lt;head&gt;<br>
&lt;meta http-equiv=&quot;Content-Language&quot; content=&quot;zh-cn&quot;&gt;<br>
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=gb2312&quot;&gt;<br>
&lt;LINK href=&quot;images/ivr.css&quot; type=text/css rel=stylesheet&gt;<br>
&lt;meta name=&quot;GENERATOR&quot; content=&quot;Microsoft FrontPage 4.0&quot;&gt;<br>
&lt;meta name=&quot;ProgId&quot; content=&quot;FrontPage.Editor.Document&quot;&gt;</p>
<p>&lt;title&gt;告警管理&lt;/title&gt;<br>
&lt;/head&gt;</p>
<p>&lt;body&gt;<br>
&lt;%<br>
String gaojing=&quot;&quot;;<br>
try<br>
{<br>
AlertManager am = SystemModelFactory.getAlertManager();<br>
AlertEvent ae = am.listLastAlert();<br>
<br>
if(ae!=null)<br>
{<br>
&nbsp;&nbsp;  System.out.println(&quot;显示的最近的告警信息：&quot;+&quot;[&quot; + ae.elementName + &quot;]--告警Id为&quot; + ae.alertId + &quot;；告警内容为&quot; + ae.info + &quot;；告警发生的时间为&quot; + ae.time + &quot;；告警网元服务类型为&quot; + ae.serviceType);<br>
&nbsp;&nbsp;  gaojing=&quot;[&quot; + ae.elementName + &quot;]--告警Id为&quot; + ae.alertId + &quot;；告警内容为&quot; + ae.info + &quot;；告警发生的时间为&quot; + ae.time + &quot;；告警网元服务类型为&quot; + ae.serviceType;<br>
&nbsp;&nbsp;  if(ae.isClosed)<br>
&nbsp;&nbsp;&nbsp;  {<br>
&nbsp;&nbsp;&nbsp;  gaojing=&quot;；已关闭&quot;;<br>
&nbsp;&nbsp;&nbsp;  }<br>
}<br>
else<br>
{<br>
&nbsp;&nbsp;  System.out.println(&quot;gaojing= &quot;+gaojing);<br>
}<br>
<br>
if(gaojing.equals(&quot;&quot;))<br>
{<br>
&nbsp;&nbsp;  gaojing=&quot;[没有最近告警]&quot;;<br>
}<br>
<strong>out.write(gaojing);//客户端请求的返回内容</strong><br>
System.out.println(&quot;=============&quot;);</p>
<p>session.setAttribute(&quot;alertEvent&quot;, ae);<br>
}catch (Exception e)<br>
{<br>
e.printStackTrace();<br>
session.setAttribute(&quot;errorInfo&quot;, e.getMessage());<br>
}<br>
%&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;</p></div></body></html>