<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Linux策略路由</title><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- top1 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3347102627476643"
     data-ad-slot="2352128818"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></head><body><h1>Linux策略路由</h1><div><p></p>
<p>基于策略的路由比传统路由在功能上更强大，使用更灵活，它使网络管理员不仅能够根据目的地址而且能够根据报文大小、应用或IP源地址来选择转发路径...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; #/etc/iproute2/rt_tables 此文件存有linux 系统路由表默认表有255 254 253三张表 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 255&nbsp; local 本地路由表 存有本地接口地址，广播地址，已及NAT地址. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; local表由系统自动维护..管理员不能操作此表... <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 254&nbsp; main 主路由表 传统路由表,ip route若没指定表亦操作表254.一般存所有的路由.. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注:平时用ip ro sh查看的亦是此表设置的路由. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 253&nbsp; default&nbsp; 默认路由表一般存放默认路由... <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注：rt_tables文件中表以数字来区分表0保留最多支持255张表 <br>&nbsp;&nbsp;<strong>&nbsp; 路由表的查看可有以下二种方法： <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route list table table_number</strong></p>
<p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route list table table_name </strong></p>
<p>&nbsp;&nbsp;&nbsp; 路由表添加完毕,即可在策略路由表内添加路由例: </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route add 192.168.1.0/24 dev eth0 via 192.168.1.66 realm 4 </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注:发往子网192.168.1.0/24的数据包通过分类4转发配合tc使用,后文有介绍讲解... </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route add default via 192.168.1.1 table int1 </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route add 192.168.1.0/24 via 192.168.1.1 table int2 </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip route add 172.16.0.2/16 via 172.16.0.1 table int3 </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注:各路由表中应当指明默认路由,尽量不回查路由表.路由添加完毕,即可在路由规则中应用.. <br>&nbsp;&nbsp;<strong>&nbsp; #ip rule&nbsp;ls 显示路由规则 <br></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from all lookup local <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32766:&nbsp; from all lookup main <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32767:&nbsp; from all lookup default <br>&nbsp;&nbsp;&nbsp; 进行路由时，正是根据路由规则来进行匹配，按优先级(pref后数值)从高到低匹配,直到找到合适的规则.所以在应用中配置默认路由是必要的..&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; 策略路由一般手工添加路由表，路由表的添加只需编辑rt_tables文件，规定表序号，表名即可.. <br>&nbsp;&nbsp;&nbsp; ip rule规则添加示例： <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip rule add from 192.168.1.112/32 [tos 0x10] table test2 pref 999 prohibit <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip rule add to 192.168.1.2 pref 1000 table test1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip rule add from 192.168.1.0/24 pref 1001 table test1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip rule add [from 0/0] table test1 pref 1003 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #ip rule add fwmark 1 pref 1002 table test2&nbsp; 此句型配合iptables -t mangle应用.如先对数据 </p></div></body></html>